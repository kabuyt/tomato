<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="„Éà„Éû„Éà N5">
    <link rel="apple-touch-icon" href="images/icon.png">
    <link rel="icon" type="image/png" href="images/icon.png">

    <title>„Éà„Éû„Éà N5 - Bug Fixed</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: #FFF9E6; color: #333; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        .page { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .active { display: block; }
        .logo-container { margin-top: 30px; }
        .logo-img { width: 100px; height: 100px; object-fit: contain; border-radius: 20%; }
        .menu-grid { display: grid; gap: 12px; max-width: 400px; margin: 20px auto; padding: 10px; }
        .menu-btn { 
            padding: 20px; font-size: 19px; font-weight: bold; border: none; border-radius: 20px; 
            background: white; border-bottom: 5px solid #FFCDD2; cursor: pointer; color: #FF5252; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .menu-btn:active { transform: translateY(2px); border-bottom-width: 2px; }
        .list-btn { background: #FFAB91; color: white; border-bottom-color: #D84315; margin-top: 10px; }
        #mode-selection { background: white; border-radius: 25px; padding: 20px; border: 3px solid #FF5252; margin-top: 10px; display: none; }
        .card { 
            background: white; border-radius: 30px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            max-width: 500px; margin: 10px auto; border: 4px solid #FF5252; min-height: 380px; 
            display: flex; flex-direction: column; justify-content: center; position: relative; 
        }
        .word { font-size: 45px; font-weight: bold; color: #FF5252; margin: 10px 0; }
        .options { display: grid; gap: 10px; margin-top: 10px; }
        .opt-btn { padding: 18px; font-size: 18px; border: none; border-radius: 15px; background: #FFEBEE; border-bottom: 4px solid #FFCDD2; cursor: pointer; }
        .mode-selector { background: #FF5252; padding: 10px; border-radius: 15px; display: inline-block; color: white; margin-bottom: 10px; font-size: 12px; }
        select { border-radius: 5px; border: none; padding: 3px; background: white; margin: 0 5px; }
        .btn-back { background: #666; color: white; border: none; padding: 10px 20px; border-radius: 12px; margin-bottom: 15px; cursor: pointer; }
        .list-item { background: white; margin: 8px auto; padding: 12px; border-radius: 12px; max-width: 500px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #FFCDD2; padding: 15px; }
    </style>
</head>
<body>

    <div id="menu-page" class="page active">
        <div class="logo-container">
            <img src="images/icon.png" alt="üçÖ" class="logo-img" onerror="this.style.display='none'; document.getElementById('emoji-logo').style.display='block';">
            <div id="emoji-logo" style="display:none; font-size:80px;">üçÖ</div>
        </div>
        <h1 style="color:#FF5252;">„Éà„Éû„Éà N5</h1>
        <div class="menu-grid">
            <button class="menu-btn" onclick="selectCategory('verb')">üçé „Å©„ÅÜ„Åó (Verb)</button>
            <button class="menu-btn" onclick="selectCategory('noun')">üìò „ÇÅ„ÅÑ„Åó (Noun)</button>
            <button class="menu-btn" onclick="selectCategory('adj')">‚ú® „Åë„ÅÑ„Çà„ÅÜ„Åó (Adj)</button>
            <div id="mode-selection">
                <p id="selected-label" style="font-weight:bold; color:#FF5252;"></p>
                <div style="display:grid; gap:10px;">
                    <button class="menu-btn" style="background:#FFF3E0;" onclick="startGame('practice')">üìñ „Çå„Çì„Åó„ÇÖ„ÅÜ (All)</button>
                    <button class="menu-btn" style="background:#FFEBEE;" onclick="startGame('test')">üìù „Å¶„Åô„Å® (10)</button>
                    <button class="btn-back" onclick="cancelSelection()">„ÇÇ„Å©„Çã</button>
                </div>
            </div>
            <button class="menu-btn list-btn" onclick="showListPage()">üìã „É™„Çπ„Éà„Çí„Åø„Çã</button>
        </div>
    </div>

    <div id="quiz-page" class="page">
        <button class="btn-back" onclick="goToMenu()">‚Üê Menu</button>
        <div class="mode-selector">
            Lang: <select id="lang-select" onchange="initGame()"><option value="vi">Vi·ªát</option><option value="id">Indo</option></select>
            Type: <select id="teacher-switch" onchange="initGame()"><option value="student">Student</option><option value="teacher">Teacher</option></select>
        </div>
        <div class="card" id="main-card">
            <div id="quiz-content">
                <div id="progress" style="font-size:14px; color:#999">...</div>
                <div id="word" class="word">...</div>
                <div class="options" id="options-container"></div>
                <div id="teacher-controls" style="display:none; gap:10px; justify-content:center; margin-top:20px;">
                    <button class="opt-btn" onclick="toggleAnswer()" style="background:#333; color:white;">Answer</button>
                    <button class="opt-btn" onclick="nextQuestion()" style="background:#FF5252; color:white;">Next</button>
                </div>
                <div id="message" style="margin-top:20px; font-weight:bold; font-size:26px; height:30px; color:#FF5252;"></div>
            </div>
            <div id="result-content" style="display:none;">
                <h2 style="color:#FF5252;">„Åä„Çè„ÇäÔºÅ</h2>
                <div id="score-display" style="font-size:60px; font-weight:bold; color:#FF5252; margin:20px 0;"></div>
                <button class="menu-btn" onclick="goToMenu()" style="width:100%">Menu„Å´„ÇÇ„Å©„Çã</button>
            </div>
        </div>
    </div>

    <div id="list-page" class="page">
        <button class="btn-back" onclick="goToMenu()">‚Üê „ÇÇ„Å©„Çã</button>
        <h2 style="color:#FF5252;">„Åì„Å®„Å∞„ÅÆ„É™„Çπ„Éà</h2>
        <div id="list-container"></div>
    </div>

    <script>
        const allData = [
            // „Å©„ÅÜ„Åó (45Ë™û) - „Åô„Åπ„Å¶„Å≤„Çâ„Åå„Å™
            { q: "„ÅÇ„ÅÜ", v: "g·∫∑p", i: "bertemu", g: 1 },
            { q: "„ÅÑ„Åè", v: "ƒëi", i: "pergi", g: 1 },
            { q: "„Åã„Åà„Çã", v: "v·ªÅ", i: "pulang", g: 1 },
            { q: "„ÅÆ„ÇÄ", v: "u·ªëng", i: "minum", g: 1 },
            { q: "„Åã„ÅÜ", v: "mua", i: "membeli", g: 1 },
            { q: "„Åç„Åè", v: "nghe", i: "mendengar", g: 1 },
            { q: "„Åã„Åè", v: "vi·∫øt", i: "menulis", g: 1 },
            { q: "„Çà„ÇÄ", v: "ƒë·ªçc", i: "membaca", g: 1 },
            { q: "„ÅÑ„ÅÜ", v: "n√≥i", i: "berbicara", g: 1 },
            { q: "„Åæ„Å§", v: "ƒë·ª£i", i: "menunggu", g: 1 },
            { q: "„Çà„Å∂", v: "g·ªçi", i: "memanggil", g: 1 },
            { q: "„ÅÇ„Åù„Å∂", v: "ch∆°i", i: "bermain", g: 1 },
            { q: "„ÅÑ„Åù„Åê", v: "v·ªôi v√†ng", i: "terburu-buru", g: 1 },
            { q: "„Åä„Çà„Åê", v: "b∆°i", i: "berenang", g: 1 },
            { q: "„ÅØ„Å™„Åô", v: "n√≥i chuy·ªán", i: "berbicara", g: 1 },
            { q: "„Åü„Å§", v: "ƒë·ª©ng", i: "berdiri", g: 1 },
            { q: "„Åô„Çè„Çã", v: "ng·ªìi", i: "duduk", g: 1 },
            { q: "„ÅØ„ÅÑ„Çã", v: "v√†o", i: "masuk", g: 1 },
            { q: "„ÅÜ„Çã", v: "b√°n", i: "menjual", g: 1 },
            { q: "„Å§„Åè„Çã", v: "l√†m", i: "membuat", g: 1 },
            { q: "„Åó„Çã", v: "bi·∫øt", i: "tahu", g: 1 },
            { q: "„Çè„Åã„Çã", v: "hi·ªÉu", i: "mengerti", g: 1 },
            { q: "„Åä„Çè„Çã", v: "xong", i: "selesai", g: 1 },
            { q: "„Åä„Åè„Çã", v: "g·ª≠i", i: "mengirim", g: 1 },
            { q: "„ÅÜ„Åü„ÅÜ", v: "h√°t", i: "bernyanyi", g: 1 },
            { q: "„ÅÇ„Çã„Åè", v: "ƒëi b·ªô", i: "berjalan kaki", g: 1 },
            { q: "„Åä„Åè", v: "ƒë·∫∑t/ƒë·ªÉ", i: "menaruh", g: 1 },
            { q: "„Å†„Åô", v: "l·∫•y ra", i: "mengeluarkan", g: 1 },
            { q: "„ÇÇ„Å§", v: "c·∫ßm/n·∫Øm", i: "memegang", g: 1 },
            { q: "„ÇÑ„Åô„ÇÄ", v: "ngh·ªâ ng∆°i", i: "beristirahat", g: 1 },
            { q: "„Åä„Åç„Çã", v: "th·ª©c d·∫≠y", i: "bangun", g: 2 },
            { q: "„Å≠„Çã", v: "ng·ªß", i: "tidur", g: 2 },
            { q: "„Åü„Åπ„Çã", v: "ƒÉn", i: "makan", g: 2 },
            { q: "„Åø„Çã", v: "xem/nh√¨n", i: "melihat", g: 2 },
            { q: "„ÅÇ„Åë„Çã", v: "m·ªü", i: "membuka", g: 2 },
            { q: "„Åó„ÇÅ„Çã", v: "ƒë√≥ng", i: "menutup", g: 2 },
            { q: "„Åä„Åó„Åà„Çã", v: "d·∫°y", i: "mengajar", g: 2 },
            { q: "„Çè„Åô„Çå„Çã", v: "qu√™n", i: "lupa", g: 2 },
            { q: "„Åß„Çã", v: "ra ngo√†i", i: "keluar", g: 2 },
            { q: "„Åã„Çä„Çã", v: "m∆∞·ª£n", i: "meminjam", g: 2 },
            { q: "„Åè„Çã", v: "ƒë·∫øn", i: "datang", g: 3 },
            { q: "„Åô„Çã", v: "l√†m", i: "melakukan", g: 3 },
            { q: "„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã", v: "h·ªçc", i: "belajar", g: 3 },
            { q: "„Åã„ÅÑ„ÇÇ„ÅÆ„Åô„Çã", v: "mua s·∫Øm", i: "belanja", g: 3 },
            { q: "„Åï„Çì„ÅΩ„Åô„Çã", v: "ƒëi d·∫°o", i: "jalan-jalan", g: 3 },

            // „ÇÅ„ÅÑ„Åó
            { q: "„Åå„Å£„Åì„ÅÜ", v: "tr∆∞·ªùng h·ªçc", i: "sekolah", g: 0 },
            { q: "„Åõ„Çì„Åõ„ÅÑ", v: "gi√°o vi√™n", i: "guru", g: 0 },
            { q: "„Å®„ÇÇ„Å†„Å°", v: "b·∫°n b√®", i: "teman", g: 0 },
            { q: "„Åî„ÅØ„Çì", v: "c∆°m", i: "nasi", g: 0 },
            { q: "„Åª„Çì", v: "s√°ch", i: "buku", g: 0 },

            // „Åë„ÅÑ„Çà„ÅÜ„Åó
            { q: "„Åü„Åã„ÅÑ", v: "cao/ƒë·∫Øt", i: "tinggi/mahal", g: 4 },
            { q: "„ÇÑ„Åô„ÅÑ", v: "r·∫ª", i: "murah", g: 4 },
            { q: "„Åä„ÅÑ„Åó„ÅÑ", v: "ngon", i: "enak", g: 4 }
        ];

        let currentCategory = '';
        let currentMode = '';
        let quizList = [];
        let current = 0;
        let score = 0;
        let isAnswerShowing = false;

        function speak(text) {
            const uttr = new SpeechSynthesisUtterance();
            uttr.text = text;
            uttr.lang = "ja-JP";
            window.speechSynthesis.speak(uttr);
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id + '-page').classList.add('active');
        }

        function selectCategory(cat) {
            currentCategory = cat;
            document.getElementById('mode-selection').style.display = 'block';
            const labels = {verb: "üçé „Å©„ÅÜ„Åó", noun: "üìò „ÇÅ„ÅÑ„Åó", adj: "‚ú® „Åë„ÅÑ„Çà„ÅÜ„Åó"};
            document.getElementById('selected-label').innerText = labels[cat];
            document.querySelectorAll('.menu-grid > .menu-btn').forEach(b => b.style.display = 'none');
        }

        function cancelSelection() {
            document.getElementById('mode-selection').style.display = 'none';
            document.querySelectorAll('.menu-grid > .menu-btn').forEach(b => b.style.display = 'flex');
        }

        function startGame(mode) {
            currentMode = mode;
            showPage('quiz');
            initGame();
        }

        function goToMenu() {
            cancelSelection();
            showPage('menu');
        }

        function initGame() {
            const isTeacher = document.getElementById("teacher-switch").value === "teacher";
            document.getElementById("main-card").className = isTeacher ? "card teacher-mode" : "card";
            document.getElementById("teacher-controls").style.display = isTeacher ? "flex" : "none";
            document.getElementById("options-container").style.display = isTeacher ? "none" : "grid";
            document.getElementById("quiz-content").style.display = "block";
            document.getElementById("result-content").style.display = "none";

            let data;
            if(currentCategory === 'verb') data = allData.filter(d => d.g >= 1 && d.g <= 3);
            else if(currentCategory === 'noun') data = allData.filter(d => d.g === 0);
            else data = allData.filter(d => d.g === 4);
            
            quizList = [...data].sort(() => Math.random() - 0.5);
            if(currentMode === 'test') quizList = quizList.slice(0, 10);
            
            current = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            const isTeacher = document.getElementById("teacher-switch").value === "teacher";
            const lang = document.getElementById("lang-select").value;
            const item = quizList[current];
            isAnswerShowing = false;

            document.getElementById("progress").innerText = (current + 1) + " / " + quizList.length;
            document.getElementById("word").innerText = item.q;
            document.getElementById("message").innerText = "";

            if(!isTeacher) {
                const correct = (lang === "vi") ? item.v : item.i;
                
                // ‰øÆÊ≠£Ôºö„Éè„Ç∫„É¨„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁ¢∫ÂÆü„Å´4„Å§‰Ωú„ÇãÔºàÁèæÂú®„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éº„Å†„Åë„Åß„Å™„ÅèÂÖ®„Éá„Éº„Çø„Åã„ÇâÈÅ∏„Å∂„Åì„Å®„Åß„ÄÅÈÅ∏ÊäûËÇ¢„ÅåË∂≥„Çä„Å™„Åè„Å™„Çã„Éê„Ç∞„ÇíÈò≤„ÅêÔºâ
                const others = allData
                    .map(d => (lang === "vi") ? d.v : d.i)
                    .filter(v => v !== correct);
                
                // ÈáçË§á„ÇíÈô§Âéª
                const uniqueOthers = [...new Set(others)].sort(() => Math.random() - 0.5);
                
                let choices = [correct, uniqueOthers[0], uniqueOthers[1], uniqueOthers[2]];
                choices.sort(() => Math.random() - 0.5);

                const container = document.getElementById("options-container");
                container.innerHTML = "";
                choices.forEach(c => {
                    const btn = document.createElement("button");
                    btn.className = "opt-btn";
                    btn.innerText = c;
                    btn.onclick = () => {
                        if(c === correct) {
                            speak(item.q);
                            document.getElementById("message").innerText = "‚≠ï OK!";
                            score++;
                            setTimeout(nextQuestion, 800);
                        } else {
                            document.getElementById("message").innerText = "‚ùå " + correct;
                            setTimeout(nextQuestion, 1500);
                        }
                    };
                    container.appendChild(btn);
                });
            }
        }

        function toggleAnswer() {
            const lang = document.getElementById("lang-select").value;
            const item = quizList[current];
            if(!isAnswerShowing) {
                document.getElementById("message").innerText = (lang === "vi") ? item.v : item.i;
                speak(item.q);
                isAnswerShowing = true;
            } else {
                document.getElementById("message").innerText = "";
                isAnswerShowing = false;
            }
        }

        function nextQuestion() {
            current++;
            if(current < quizList.length) showQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById("quiz-content").style.display = "none";
            document.getElementById("result-content").style.display = "block";
            const scoreArea = document.getElementById("score-display");
            scoreArea.innerText = currentMode === 'test' ? Math.round((score/quizList.length)*100) + "%" : "Finish!";
        }

        function showListPage() {
            showPage('list');
            const container = document.getElementById('list-container');
            container.innerHTML = "";
            const lang = document.getElementById("lang-select").value;
            allData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.onclick = () => speak(item.q);
                const meaning = (lang === "vi") ? item.v : item.i;
                div.innerHTML = `<div style="text-align:left;"><b style="font-size:20px; color:#FF5252;">${item.q}</b><br><span style="color:#666;">${meaning}</span></div><div>üîä</div>`;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
