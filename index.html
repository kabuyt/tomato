<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="„Éà„Éû„Éà N5">
    
    <title>„Éà„Éû„Éà N5 - Final Audio Fix</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: #FFF9E6; color: #333; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        .page { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .active { display: block; }
        .main-logo { font-size: 80px; margin-top: 30px; display: block; }
        .menu-grid { display: grid; gap: 12px; max-width: 400px; margin: 20px auto; padding: 10px; }
        .menu-btn { 
            padding: 20px; font-size: 19px; font-weight: bold; border: none; border-radius: 20px; 
            background: white; border-bottom: 5px solid #FFCDD2; cursor: pointer; color: #FF5252; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .list-btn { background: #FFAB91; color: white; border-bottom-color: #D84315; margin-top: 10px; }
        #mode-selection { background: white; border-radius: 25px; padding: 20px; border: 3px solid #FF5252; margin-top: 10px; display: none; }
        
        .list-section-title { text-align: left; font-size: 20px; font-weight: bold; color: #FF5252; margin: 25px auto 10px; border-left: 6px solid #FF5252; padding-left: 12px; max-width: 500px; }
        .list-item { background: white; margin: 8px auto; padding: 12px; border-radius: 15px; max-width: 500px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #FFCDD2; cursor: pointer; }
        .list-item:hover { background: #FFF3E0; }
        .cat-tag { font-size: 10px; padding: 2px 8px; border-radius: 6px; color: white; margin-left: 8px; vertical-align: middle; font-weight: bold; }
        .speaker-icon { font-size: 24px; color: #FF5252; }
        
        .btn-back { background: #666; color: white; border: none; padding: 10px 20px; border-radius: 12px; margin-bottom: 15px; cursor: pointer; }
        .card { background: white; border-radius: 30px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; margin: 10px auto; border: 4px solid #FF5252; min-height: 380px; display: flex; flex-direction: column; justify-content: center; }
        .word { font-size: 45px; font-weight: bold; color: #FF5252; margin: 10px 0; }
        .opt-btn { padding: 18px; font-size: 18px; border: none; border-radius: 15px; background: #FFEBEE; border-bottom: 4px solid #FFCDD2; cursor: pointer; margin-bottom: 8px; width: 100%; }
    </style>
</head>
<body>

    <div id="menu-page" class="page active">
        <span class="main-logo">üçÖ</span>
        <h1 style="color:#FF5252;">„Éà„Éû„Éà N5</h1>
        <div class="menu-grid">
            <button class="menu-btn" onclick="unlockAudio('verb')">üçé „Å©„ÅÜ„Åó</button>
            <button class="menu-btn" onclick="unlockAudio('noun')">üìò „ÇÅ„ÅÑ„Åó</button>
            <button class="menu-btn" onclick="unlockAudio('adj')">‚ú® „Åë„ÅÑ„Çà„ÅÜ„Åó</button>
            <div id="mode-selection">
                <p id="selected-label" style="font-weight:bold; color:#FF5252; margin-bottom:15px;"></p>
                <button class="menu-btn" style="background:#FFF3E0; width:100%; margin-bottom:10px;" onclick="startGame('practice')">üìñ „Çå„Çì„Åó„ÇÖ„ÅÜ</button>
                <button class="menu-btn" style="background:#FFEBEE; width:100%; margin-bottom:10px;" onclick="startGame('test')">üìù „Å¶„Åô„Å®</button>
                <button class="btn-back" onclick="cancelSelection()">„ÇÇ„Å©„Çã</button>
            </div>
            <button class="menu-btn list-btn" onclick="unlockAudio('list')">üìã „É™„Çπ„Éà„Çí„Åø„Çã</button>
        </div>
    </div>

    <div id="quiz-page" class="page">
        <button class="btn-back" onclick="goToMenu()">‚Üê Menu</button>
        <div class="card">
            <div id="quiz-content">
                <div id="progress" style="font-size:14px; color:#999"></div>
                <div id="word" class="word" onclick="speakText(this.innerText)"></div>
                <div id="options-container"></div>
                <div id="message" style="margin-top:20px; font-weight:bold; font-size:24px; color:#FF5252; height:30px;"></div>
            </div>
            <div id="result-content" style="display:none;">
                <h2 style="color:#FF5252;">„Åä„Çè„ÇäÔºÅ</h2>
                <div id="score-display" style="font-size:60px; font-weight:bold; color:#FF5252;"></div>
                <button class="menu-btn" onclick="goToMenu()" style="width:100%">Menu„Å´„ÇÇ„Å©„Çã</button>
            </div>
        </div>
    </div>

    <div id="list-page" class="page">
        <button class="btn-back" onclick="goToMenu()">‚Üê „ÇÇ„Å©„Çã</button>
        <h2 style="color:#FF5252;">„Åì„Å®„Å∞„ÅÆ„É™„Çπ„Éà</h2>
        <div id="list-container"></div>
    </div>

    <script>
        const allData = [
            {q:"„ÅÇ„ÅÜ",v:"g·∫∑p",g:1},{q:"„ÅÑ„Åè",v:"ƒëi",g:1},{q:"„Åã„Åà„Çã",v:"v·ªÅ",g:1},{q:"„ÅÆ„ÇÄ",v:"u·ªëng",g:1},{q:"„Åã„ÅÜ",v:"mua",g:1},{q:"„Åç„Åè",v:"nghe",g:1},{q:"„Åã„Åè",v:"vi·∫øt",g:1},{q:"„Çà„ÇÄ",v:"ƒë·ªçc",g:1},{q:"„ÅÑ„ÅÜ",v:"n√≥i",g:1},{q:"„Åæ„Å§",v:"ƒë·ª£i",g:1},{q:"„Çà„Å∂",v:"g·ªçi",g:1},{q:"„ÅÇ„Åù„Å∂",v:"ch∆°i",g:1},{q:"„ÅÑ„Åù„Åê",v:"v·ªôi",g:1},{q:"„Åä„Çà„Åê",v:"b∆°i",g:1},{q:"„ÅØ„Å™„Åô",v:"n√≥i",g:1},{q:"„Åü„Å§",v:"ƒë·ª©ng",g:1},{q:"„Åô„Çè„Çã",v:"ng·ªìi",g:1},{q:"„ÅØ„ÅÑ„Çã",v:"v√†o",g:1},{q:"„ÅÜ„Çã",v:"b√°n",g:1},{q:"„Å§„Åè„Çã",v:"l√†m",g:1},{q:"„Åä„Çè„Çã",v:"xong",g:1},{q:"„ÅÇ„Çã„Åè",v:"ƒëi b·ªô",g:1},{q:"„Åä„Åè",v:"ƒë·∫∑t",g:1},{q:"„Å†„Åô",v:"l·∫•y ra",g:1},{q:"„Åä„Åç„Çã",v:"d·∫≠y",g:2},{q:"„Å≠„Çã",v:"ng·ªß",g:2},{q:"„Åü„Åπ„Çã",v:"ƒÉn",g:2},{q:"„Åø„Çã",v:"xem",g:2},{q:"„ÅÇ„Åë„Çã",v:"m·ªü",g:2},{q:"„Åó„ÇÅ„Çã",v:"ƒë√≥ng",g:2},{q:"„Åè„Çã",v:"ƒë·∫øn",g:3},{q:"„Åô„Çã",v:"l√†m",g:3},
            {q:"„Åå„Å£„Åì„ÅÜ",v:"tr∆∞·ªùng",g:0},{q:"„Åõ„Çì„Åõ„ÅÑ",v:"gi√°o vi√™n",g:0},{q:"„Å®„ÇÇ„Å†„Å°",v:"b·∫°n",g:0},{q:"„Åø„Åö",v:"n∆∞·ªõc",g:0},{q:"„Åî„ÅØ„Çì",v:"c∆°m",g:0},{q:"„Åª„Çì",v:"s√°ch",g:0},{q:"„Åè„Çã„Åæ",v:"xe",g:0},{q:"„Åã„Å∞„Çì",v:"t√∫i",g:0},{q:"„Å®„Åë„ÅÑ",v:"ƒë·ªìng h·ªì",g:0},{q:"„Å§„Åè„Åà",v:"b√†n",g:0},{q:"„ÅÑ„Åô",v:"gh·∫ø",g:0},{q:"„Åä„Åã„Å≠",v:"ti·ªÅn",g:0},{q:"„ÅÇ„Åó„Åü",v:"mai",g:0},{q:"„Åç„Çá„ÅÜ",v:"nay",g:0},{q:"„Åç„ÅÆ„ÅÜ",v:"qua",g:0},{q:"„Åã„Åû„Åè",v:"gia ƒë√¨nh",g:0},
            {q:"„Åü„Åã„ÅÑ",v:"cao/ƒë·∫Øt",g:4},{q:"„ÇÑ„Åô„ÅÑ",v:"r·∫ª",g:4},{q:"„Åä„ÅÑ„Åó„ÅÑ",v:"ngon",g:4},{q:"„ÅÇ„Å§„ÅÑ",v:"n√≥ng",g:4},{q:"„Åï„ÇÄ„ÅÑ",v:"l·∫°nh",g:4},{q:"„ÅÑ„ÅÑ",v:"t·ªët",g:4},{q:"„Çè„Çã„ÅÑ",v:"x·∫•u",g:4},{q:"„Åä„Åä„Åç„ÅÑ",v:"l·ªõn",g:4}
        ];

        let currentCategory = '', currentMode = '', quizList = [], current = 0, score = 0;

        // ‚òÖ Èü≥Â£∞„Ç®„É≥„Ç∏„É≥„ÅÆ„Ç¢„É≥„É≠„ÉÉ„ÇØÔºàÈáçË¶ÅÔºâ
        function unlockAudio(target) {
            // Á©∫„ÅÆÈü≥Â£∞„ÇíÂá∫„Åó„Å¶„Éñ„É©„Ç¶„Ç∂„ÅÆÂà∂Èôê„ÇíËß£Èô§
            const silent = new SpeechSynthesisUtterance("");
            window.speechSynthesis.speak(silent);

            if(target === 'list') {
                showListPage();
            } else {
                selectCategory(target);
            }
        }

        function speakText(text) {
            window.speechSynthesis.cancel();
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            uttr.rate = 1.0;
            window.speechSynthesis.speak(uttr);
        }

        function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id + '-page').classList.add('active'); }
        function selectCategory(cat) { currentCategory = cat; document.getElementById('mode-selection').style.display = 'block'; document.querySelectorAll('.menu-btn:not(#mode-selection button)').forEach(b => b.style.display = 'none'); }
        function cancelSelection() { document.getElementById('mode-selection').style.display = 'none'; document.querySelectorAll('.menu-btn').forEach(b => b.style.display = 'flex'); }
        function goToMenu() { cancelSelection(); showPage('menu'); }

        function startGame(mode) {
            currentMode = mode;
            let data = (currentCategory === 'verb') ? allData.filter(d => d.g >= 1 && d.g <= 3) : (currentCategory === 'noun') ? allData.filter(d => d.g === 0) : allData.filter(d => d.g === 4);
            quizList = [...data].sort(() => Math.random() - 0.5);
            if(mode === 'test') quizList = quizList.slice(0, 10);
            current = 0; score = 0;
            showPage('quiz');
            document.getElementById("quiz-content").style.display = "block";
            document.getElementById("result-content").style.display = "none";
            showQuestion();
        }

        function showQuestion() {
            let item = quizList[current];
            document.getElementById("progress").innerText = (current + 1) + " / " + quizList.length;
            document.getElementById("word").innerText = item.q;
            speakText(item.q); // Ëá™ÂãïË™≠„Åø‰∏ä„Åí
            document.getElementById("message").innerText = "";
            let correct = item.v;
            let others = allData.map(d => d.v).filter(v => v !== correct);
            let choices = [correct, ...[...new Set(others)].sort(() => Math.random() - 0.5).slice(0, 3)].sort(() => Math.random() - 0.5);
            let container = document.getElementById("options-container");
            container.innerHTML = "";
            choices.forEach(c => {
                let btn = document.createElement("button"); btn.className = "opt-btn"; btn.innerText = c;
                btn.onclick = () => {
                    if(c === correct) { document.getElementById("message").innerText = "‚≠ï OK!"; score++; setTimeout(nextQuestion, 800); }
                    else { document.getElementById("message").innerText = "‚ùå " + correct; speakText(item.q); setTimeout(nextQuestion, 1500); }
                };
                container.appendChild(btn);
            });
        }

        function nextQuestion() { current++; if(current < quizList.length) showQuestion(); else showResult(); }
        function showResult() { document.getElementById("quiz-content").style.display = "none"; document.getElementById("result-content").style.display = "block"; document.getElementById("score-display").innerText = score + "/" + quizList.length; }

        function showListPage() {
            showPage('list');
            const container = document.getElementById('list-container');
            container.innerHTML = "";
            const cats = [
                { title: "üçé „Å©„ÅÜ„Åó", filter: d => d.g >= 1 && d.g <= 3, color: "#EF5350", label: "„Å©„ÅÜ„Åó" },
                { title: "üìò „ÇÅ„ÅÑ„Åó", filter: d => d.g === 0, color: "#42A5F5", label: "„ÇÅ„ÅÑ„Åó" },
                { title: "‚ú® „Åë„ÅÑ„Çà„ÅÜ„Åó", filter: d => d.g === 4, color: "#66BB6A", label: "„Åë„ÅÑ„Çà„ÅÜ„Åó" }
            ];
            cats.forEach(c => {
                const filtered = allData.filter(c.filter).sort((a,b) => a.q.localeCompare(b.q, 'ja'));
                if (filtered.length > 0) {
                    const h3 = document.createElement('div');
                    h3.className = 'list-section-title';
                    h3.innerText = c.title;
                    container.appendChild(h3);
                    filtered.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'list-item';
                        div.innerHTML = `<div style="text-align:left;"><b style="font-size:18px;">${item.q}</b><span class="cat-tag" style="background:${c.color}">${c.label}</span><br><span style="color:#666;">${item.v}</span></div><div class="speaker-icon">üîä</div>`;
                        div.onclick = () => { speakText(item.q); };
                        container.appendChild(div);
                    });
                }
            });
        }
    </script>
</body>
</html>
